---
import { Icon } from "astro-icon";
---

<div id="color-toggle">
  <div id="dark-mode">
    <Icon pack="ri" name="moon-clear-fill" />
  </div>
  <div id="light-mode">
    <Icon pack="ph" name="sun-dim-bold" />
  </div>
</div>

<script>
  function setDarkMode() {
    document.body.classList.remove("light-mode");
    document.body.classList.add("dark-mode");
    localStorage.setItem("color-scheme", "dark");
  }

  function setLightMode() {
    document.body.classList.remove("dark-mode");
    document.body.classList.add("light-mode");
    localStorage.setItem("color-scheme", "light");
  }

  function checkColorPref() {
    let colorPref = localStorage.getItem("color-scheme");
    if (colorPref === null) {
      setColorPref();
      return;
    }
    colorPref === "dark" ? setDarkMode() : setLightMode();
  }

  function setColorPref() {
    !localStorage.getItem("color-scheme") &&
    window.matchMedia &&
    window.matchMedia("(prefers-color-scheme: dark)").matches
      ? setDarkMode()
      : setLightMode();
  }

  document.getElementById("dark-mode")?.addEventListener("click", setDarkMode);

  document
    .getElementById("light-mode")
    ?.addEventListener("click", setLightMode);

  document.addEventListener("DOMContentLoaded", checkColorPref);
</script>

<style>
  body.dark-mode {
    & #dark-mode {
      display: none;
    }
  }

  body.light-mode {
    & #light-mode {
      display: none;
    }
  }

  #color-toggle {
    margin: 0.5rem;
    position: fixed;
    left: 0;
    bottom: 10%;
    opacity: 0.8;
    color: var(--color1);
    z-index: 5;
  }

  [astro-icon] {
    width: 25px;
    cursor: pointer;

    &:hover {
      color: var(--accent1);
    }
  }
</style>
